function wol(a){var e=a.split("_"),s=e[0],t=e[1];$.ajax({url:"api/wol",type:"POST",data:{nId:s,mId:t},dataType:"JSON",error:handleAjaxError,success:function(e){if(e.success)for(alertInfo("WOL "+e.mName+" : "+e.reason),i=0;24>i;i++)setTimeout(function(){getStatus(a)},1e4*i);else alertError("WOL "+e.mName+" : "+e.reason)}})}function getStatus(a){$.ajax({url:"api/status/"+a.replace("_","/"),type:"GET",dataType:"JSON",error:handleAjaxError,success:function(e){var s="";$.each(e,function(a,e){s+=e.success?'<span class="label label-success">'+e.port+"</span> ":110==e.errorcode?'<span class="label label-default">'+e.port+"</span> ":'<span class="label label-danger">'+e.port+"</span> "}),$("#status_"+a).html(s)}})}function refreshStatus(){for(i=0;i<statusConfig.length;i++)getStatus(statusConfig[i])}function getConfig(){$.ajax({url:"api/config",type:"GET",dataType:"JSON",error:handleAjaxError,success:function(a){processConfig(a),refreshStatus(),$("#feedback").html("&nbsp;")}})}function processConfig(a){var e="";statusConfig=[],$.each(a,function(a,s){e+='<div class="list-group">',e+='<a href="#" class="list-group-item active">'+s.name+"</a>",$.each(s.machines,function(s,t){statusConfig.push(a+"_"+s),e+='<a class="list-group-item" href="#">',e+='<div class="row">',e+='<div class="col-xs-10">',e+='<div class="row">',e+='<div class="col-xs-4">'+t.name+"</div>",e+='<div id="status_'+a+"_"+s+'" class="col-xs-8">',$.each(t.servicePorts,function(a,s){e+='<span class="label label-warning">'+s+"</span> "}),e+="</div>",e+="</div>",e+="</div>",t.hasWol&&(e+='<div class="col-xs-2">',e+='<button id="actionWOL_'+a+"_"+s+'" type="button" class="btn btn-default pull-right">',e+='  <span class="glyphicon glyphicon-off pull-right" aria-hidden="true"></span>',e+="</button>",e+="</div>"),e+="</div>",e+="</a>"}),e+="</div>"}),$("#mainBody").html(e),$("button[id^='actionWOL_']").on("click touchstart",function(){wol(this.id.replace("actionWOL_",""))})}function alertInfo(a){$("#feedback").html("<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon glyphicon-info-sign'></span> "+a+"</div>"),setTimeout(function(){$("#feedback").html("&nbsp;")},5e3)}function alertError(a){$("#feedback").html("<div class='alert alert-danger' role='alert'><span class='glyphicon glyphicon-exclamation-sign'></span> "+a+"</div>"),setTimeout(function(){$("#feedback").html("&nbsp;")},1e4)}function handleAjaxError(a){alertError(0==a.status?"No internet connection":200!=a.status?a.status+" "+a.statusText:"AJAX unknown error")}var statusConfig=[];$("body").ready(function(){getConfig(),setInterval(function(){refreshStatus()},3e4);var a=0;$("body").pullToRefresh().on("end.pulltorefresh",function(){a>25?($("#feedback").html("<div class='alert alert-info' role='alert'><center><span class='glyphicon glyphicon-refresh'></span></center></div>"),getConfig()):$("#feedback").html("&nbsp"),a=0}).on("move.pulltorefresh",function(e,s){var t="";t+="<center>",t+=s>25?"<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon-refresh'></span> release to refresh</div>":"<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon-hand-down'></span> keep scrolling down to refresh</div>",t+="</center>",$("#feedback").html(t),a=s})});