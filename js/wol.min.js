function wol(a){var b=a.split("_"),c=b[0],d=b[1];$.ajax({url:"api/wol",type:"POST",data:{nId:c,mId:d},dataType:"JSON",error:handleAjaxError,success:function(b){if(b.success)for(alertInfo("WOL "+b.mName+" : "+b.reason),i=0;12>i;i++)setTimeout(function(){getStatus(a)},1e4*i);else alertError("WOL "+b.mName+" : "+b.reason)}})}function getStatus(a){$.ajax({url:"api/status/"+a.replace("_","/"),type:"GET",dataType:"JSON",error:handleAjaxError,success:function(b){var c="";$.each(b,function(a,b){c+=b.success?'<span class="label label-success">'+b.port+"</span> ":110==b.errorcode?'<span class="label label-default">'+b.port+"</span> ":'<span class="label label-danger">'+b.port+"</span> "}),$("#status_"+a).html(c)}})}function refreshStatus(){for(i=0;i<statusConfig.length;i++)getStatus(statusConfig[i]);$("#feedback").html("&nbsp;")}function getConfig(){$.ajax({url:"api/config",type:"GET",dataType:"JSON",error:handleAjaxError,success:function(a){processConfig(a),refreshStatus()}})}function processConfig(a){var b="";statusConfig=[],$.each(a,function(a,c){b+='<div class="list-group">',b+='<a href="#" class="list-group-item active">'+c.name+"</a>",$.each(c.machines,function(c,d){statusConfig.push(a+"_"+c),b+='<a class="list-group-item" href="#">',b+='<div class="row">',b+='<div class="col-xs-10">',b+='<div class="row">',b+='<div class="col-xs-4">'+d.name+"</div>",b+='<div id="status_'+a+"_"+c+'" class="col-xs-8">',$.each(d.servicePorts,function(a,c){b+='<span class="label label-warning">'+c+"</span> "}),b+="</div>",b+="</div>",b+="</div>",d.hasWol&&(b+='<div class="col-xs-2">',b+='<button id="actionWOL_'+a+"_"+c+'" type="button" class="btn btn-default pull-right">',b+='  <span class="glyphicon glyphicon-off pull-right" aria-hidden="true"></span>',b+="</button>",b+="</div>"),b+="</div>",b+="</a>"}),b+="</div>"}),$("#mainBody").html(b),$("button[id^='actionWOL_']").on("click",function(){wol(this.id.replace("actionWOL_",""))})}function alertInfo(a){$("#feedback").html("<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon glyphicon-info-sign'></span> "+a+"</div>"),setTimeout(function(){$("#feedback").html("&nbsp;")},5e3)}function alertError(a){$("#feedback").html("<div class='alert alert-danger' role='alert'><span class='glyphicon glyphicon-exclamation-sign'></span> "+a+"</div>"),setTimeout(function(){$("#feedback").html("&nbsp;")},1e4)}function handleAjaxError(a){0==a.status?alertError("No internet connection"):200!=a.status?alertError(a.status+" "+a.statusText):alertError("AJAX unknown error")}var statusConfig=[];$("body").ready(function(){getConfig();var a=0;$("body").pullToRefresh().on("end.pulltorefresh",function(){a>25?($("#feedback").html("<div class='alert alert-info' role='alert'><center><span class='glyphicon glyphicon-refresh'></span></center></div>"),getConfig()):$("#feedback").html("&nbsp"),a=0}).on("move.pulltorefresh",function(b,c){var d="";d+="<center>",d+=c>25?"<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon-refresh'></span> release to refresh</div>":"<div class='alert alert-info' role='alert'><span class='glyphicon glyphicon-hand-down'></span> keep scrolling down to refresh</div>",d+="</center>",$("#feedback").html(d),a=c})});